!function(e) {    "use strict";    function n(e) {
        return new RegExp("(^|\\s+)" + e + "(\\s+|$)")
    }
    function t(e, n) { (a(e, n) ? s: i)(e, n)
    }
    var a, i, s;   "classList" in document.documentElement ? (a = function(e, n) {        return e.classList.contains(n)    },
    i = function(e, n) {
        e.classList.add(n)
    },
    s = function(e, n) {
        e.classList.remove(n)
    }) : (a = function(e, t) {
        return n(t).test(e.className)
    },
    i = function(e, n) {
        a(e, n) || (e.className = e.className + " " + n)
    },
    s = function(e, t) {
        e.className = e.className.replace(n(t), " ")
    });
    var c = {
        hasClass: a,
        addClass: i,
        removeClass: s,
        toggleClass: t,
        has: a,
        add: i,
        remove: s,
        toggle: t
    };
    "function" == typeof define && define.amd ? define(c) : e.classie = c
} (window),
function() {
    function e() { [].slice.call(document.querySelectorAll("input.input__field")).forEach(function(e) {
            "" !== e.value.trim() && classie.add(e.parentNode, "input--filled"),
            e.addEventListener("focus", n),
            e.addEventListener("blur", t)
        })
    }
    function n(e) {
        classie.add(e.target.parentNode, "input--filled")
    }
    function t(e) {
        "" === e.target.value.trim() && classie.remove(e.target.parentNode, "input--filled")
    }
    String.prototype.trim ||
    function() {
        var e = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
        String.prototype.trim = function() {
            return this.replace(e, "")
        }
    } (),
    setTimeout(function() {
        e()
    },
    100)
} (),
function(e) {
    function n() {
        s.each(function(n) {
            e(this).css("top", 2 * n).css("width", o - 2 * n).css("margin-left", 2 * n / 2)
        }),
        s.addClass("closed"),
        a.removeClass("active")
    }
    var t = e(".card-drop"),
    a = t.find(".toggle"),
    i = t.find("ul>li>a"),
    s = i.parent("li"),
    c = i.length,
    o = i.outerWidth();
    i.parent("li").each(function(n) {
        e(this).css("z-index", c - n)
    }),
    n(),
    a.on("mousedown",   function() {
    	var t = e(this);
        t.is(".active") ? n() : (t.addClass("active"), s.removeClass("closed"), s.each(function(n) {
            e(this).css("top", 60 * (n + 1)).css("width", "100%").css("margin-left", "0px")
        }))
    }),
    i.on("click",   function(t) {
        var i = e(this),
        c = i.data("label");
        icon = i.children("i").attr("class"),
        s.removeClass("active"),
        i.parent("li").is("active") ? i.parent("li").removeClass("active") : i.parent("li").addClass("active"),
        a.children("span").text(c),
        a.children("i").removeClass().addClass(icon),
        n(),
        t.preventDefault
    })
} (jQuery),
angular.module("loginApp", ["ngAnimate"]).controller("loginCtrl", ["$scope", "$timeout", "$http",
function(e, n, t) {
	e.loading = false
    e.user = {
        account: "",
        password: "",
    },
    e.user.account="";
    e.user.password="";
    e.user.randCode="";
	e.validCode = $('#randCodeImage').length==1;
    e.getinfo = function(){
    	$.post(__ctx + "/login.v",function(d){
        	if(d){
        		const s = atob(d);
        		e.ks = JSON.parse(atob(d));
        	}else{
        		e.ks={};
        	}
        })
    }
    e.getinfo();
    e.login = function() {
		if(e.loading){
			return
		}
		$("#sub_btn").addClass("fa fa-spinner")
        var n = $("#txtRememberMe").is(":checked") ? 1 : 0;
        e.user.rememberMe = n;
        var param = {};
        
        if(e.validCode){
        	e.user.randCode=$('#randCode').val();
			!e.$$phase && e.$digest();
        }
        if(e.ks && e.ks.k){
        	param.ticket = CryptoJS.MD5(e.ks.k+e.ks.iv).toString();
        	param.data = CryptoJS.AES.encrypt(JSON.stringify(e.user),CryptoJS.enc.Base64.parse(e.ks.k),{iv:CryptoJS.enc.Base64.parse(e.ks.iv), mode: CryptoJS.mode.CBC,padding: CryptoJS.pad.Pkcs7}).toString();
        }else{
        	param = e.user;
        }
		
		$("#sub_btn").prop("disabled", true);
        e.loading = true
        $.post(__ctx + "/login/valid",param,
        function(d) {
			e.loading = false;
			$("#sub_btn").prop("disabled", false);
			$("#sub_btn").removeClass("fa fa-spinner")
            if (d.success) {
                d.username;
                var token = d.token;
                var n = __ctx + "/main/home";
                window.localStorage.setItem('token', token);
                window.location.href = n
		     } else {
                if(d.message.indexOf('passwordExpired') > -1){
                    layer.open({
                        type:2,
                        area:['450px','340px'],
                        title:d.message.replace('passwordExpired-',''),
                        content:__ctx + '/main/passwordExpired?userId=' + d.username,
                        closeBtn:0,
                        shadeClose:false,
                        btn:['提交'],
                        yes:function(index,layero){
                            var frameId = $(layero).find("iframe").attr('id');
                            $(window.frames[frameId].document).find("button.layui-btn").click();
                        }
                    });
                }else{
                	reloadRandCodeImage();
                	e.getinfo();
                    $("#randCode").val('');
                    $("#divMessage").html(d.message)
                }
            }
        })
    },
    e.localeTypes = [],
    e.curLocale = {   desc: "loading.."  },  n(function() {     e.myCssVar = "css-class"  },  200),   e.myKeyup = function(n) {
    	13 == (window.event ? n.keyCode: n.which) && e.login()
    },
    e.localeChanged = function() {
        var n = $.cookie("my-locale-cookie");   n && angular.forEach(e.localeTypes,     function(t) {
            n === t.language && (e.curLocale = t)
        })
    }
    
}]);
// $('input').bind('keyup', function(event) {
//        if (event.keyCode == "13") {
//
//        	e.login();
//        	return;
//			
//            //回车执行查询
//         $.post(__ctx + "/login/valid", data,
//			function(e) {
//            if (e.success) {             
//                var n = __ctx + "/main/home";
//                var token = e.token;
//                window.localStorage.setItem('token', token);
//              window.location.href = n;		
//            } else {
//                if(e.message.indexOf('passwordExpired') > -1){
//                    layer.open({
//                        type:2,
//                        area:['450px','280px'],
//                        title:e.message.replace('passwordExpired-',''),
//                        content:__ctx + '/main/passwordExpired?userId=' + e.username,
//                        closeBtn:0,
//                        shadeClose:false,
//                        btn:['提交'],
//                        yes:function(index,layero){
//                            var frameId = $(layero).find("iframe").attr('id');
//                            $(window.frames[frameId].document).find("button.layui-btn").click();
//                        }
//                    });
//                }else{
//                    reloadRandCodeImage();
//                    $("#randCode").val('');
//                    $("#divMessage").html(e.message)
//                }
//            }
//        })
//        }
//    });


function reloadRandCodeImage() {
    var date = new Date();
    var img = document.getElementById("randCodeImage");
    img.src='randCodeImage?a=' + date.getTime();
}